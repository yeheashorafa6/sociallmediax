(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4928],{34561:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/auth/sign-up",function(){return n(76578)}])},52012:function(e,t,n){"use strict";n.d(t,{My:function(){return h},Qb:function(){return g},p9:function(){return p}});var r=n(98788),i=n(22970),o=n(5632),a=/*#__PURE__*/n.n(o),u=n(42541),c=n(90581),s=n(99669),l={defaultTTL:86400},f=new/*#__PURE__*/(function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l;(0,c.Z)(this,e),this._storage=t,this._options=n}var t=e.prototype;return t.setItem=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._options.defaultTTL,r=Math.floor(Date.now()/1e3);this._storage.setItem(e,{value:t,exp:r+n})},t.getItem=function(e){var t=this._storage.getItem(e);if(null==t||"object"!=typeof t)return t;if(!Reflect.has(t,"value")||!Reflect.has(t,"exp"))return console.warn('ExpiryLocalStorage.getItem("'.concat(e,'") - data is malformed'),t),null;var n=Math.floor(Date.now()/1e3);return n>t.exp?(console.debug('ExpiryLocalStorage.getItem("'.concat(e,'") - data has expired ').concat(n-t.exp," seconds ago")),this._storage.removeItem(e),null):t.value},t.removeItem=function(e){this._storage.removeItem(e)},t.clear=function(){this._storage.clear()},e}())(s.J),d="auth/redirect";function p(e){f.setItem(d,e,900)}function h(){return f.getItem(d)}function g(e,t){return m.apply(this,arguments)}function m(){return(m=(0,r.Z)(function(e,t){var n;return(0,i.__generator)(this,function(r){switch(r.label){case 0:if(n=h(),console.debug("Redirect to ".concat(null!=n?n:e)),!n)return[3,2];return f.removeItem(d),u.Z.trackEvent("login-page","redirect_to_saved_path",{source:t,url:n,workspaceId:n.split("/")[2]}),[4,a().replace(n)];case 1:return r.sent(),[3,4];case 2:return[4,a().replace(e)];case 3:r.sent(),r.label=4;case 4:return[2]}})})).apply(this,arguments)}},66464:function(e,t,n){"use strict";n.d(t,{i:function(){return O}});var r,i,o=n(87394),a=n(2784),u=n(5632),c=/*#__PURE__*/n.n(u),s=n(20810),l=n(39739),f=n(69904),d=n(68594),p=n(82808),h=n(35120),g=n(12335),m=n(11348),v=n(77984),_=n(52012),y=n(57821),w=n(57685),b=n(57335),I=n(98788),A=n(22970),N=n(97594),R=n(10186),T=(r=(0,I.Z)(function(e){return(0,A.__generator)(this,function(t){switch(t.label){case 0:return[4,R.Z.teams.withConverter(N.ML).where("isAutoJoinEnabled","==",!0).where("domain","==",e).get()];case 1:return[2,t.sent().docs.map(function(e){return e.data()})]}})}),function(e){return r.apply(this,arguments)}),E=(i=(0,I.Z)(function(e){return(0,A.__generator)(this,function(t){switch(t.label){case 0:return[4,R.Z.userTeams(e).limit(1).get()];case 1:return[2,!t.sent().empty]}})}),function(e){return i.apply(this,arguments)}),P=["website","notion","integration","diagramgpt","chatgpt","sourcegraph-cody"],U=n(10097),C=n(89960),Z=n(88218),x=n(24618),S=function(e){c().replace(e)},k=function(){return S("/team/create")};function O(){var e=(0,a.useState)(),t=e[0],n=e[1],r=(0,a.useState)({}),i=r[0],u=r[1],I=(0,w.K)(),A=(0,a.useRef)({redirect:"",isRedirecting:!1});(0,f.Z)(function(){var e=c().query.redirect;"string"==typeof e&&((0,_.p9)(e),A.current.redirect=e)}),(0,a.useEffect)(function(){var e,t,n,r,i;u((t=(e=I).ref,n=e.utm_campaign,r=e.templateId,i=e.page,n?{signUpOrigin:"paid",signUpCampaign:n}:r?{signUpOrigin:"website",signUpTemplate:r}:{signUpOrigin:"string"==typeof t&&P.includes(t)?t:"other",signUpPage:null!=i?i:""}))},[I]);var N=(0,a.useCallback)(function(){c().prefetch("/dashboard/all"),c().prefetch("/dashboard/recents"),c().prefetch("/team/create"),c().prefetch("/team/join")},[]),R=(0,a.useCallback)(function(){c().query.redirect_uri===b.NOTION_INTEGRATION_REDIRECT_URL&&c().replace("/notion/auth?"+new URLSearchParams(c().query).toString())},[]),O=(0,a.useCallback)(function(e){console.info("[Auth Page] Something went wrong",e),(0,C.T)(e),n(e)},[]),L=(0,s.m)(function(){var e;return(e=U.I8,new d.y(function(t){return{unsubscribe:e.onAuthStateChanged(t)}})).pipe((0,g.w)(function(e){return(0,p.s)(function(){return e&&!e.isAnonymous&&e.providerData.length>0},(0,h.of)(e).pipe((0,m.b)(function(e){return console.info("[Auth Page] User signed in:",{uid:e.uid,email:e.email,isAnonymous:e.isAnonymous,displayName:e.displayName})}),(0,m.b)(R),(0,m.b)(N),(0,m.b)(function(){var e=A.current.redirect;if(null==e?void 0:e.match("/new")){var t,n=(null===(t=c().asPath)||void 0===t?void 0:t.match("sign-up"))?"sign-up":"sign-in";(0,_.Qb)("/dashboard/all",n),A.current.isRedirecting=!0}}),(0,g.w)(function(e){return E(e.uid)}),(0,x.VK)(),(0,g.w)(function(t){return!t&&e.email&&e.emailVerified&&!A.current.isRedirecting?(0,h.of)((0,Z.ZP)(e.email)).pipe((0,g.w)(function(e){return T(e)}),(0,x.VK)(),(0,v.U)(function(e){return[t,e]})):(0,h.of)([t,[]])}),(0,m.b)(function(t){var n=(0,o.Z)(t,2),r=n[0],i=n[1];if(!A.current.isRedirecting){if(r){console.info("[Auth Page] User has team, redirect to ...");var a,u=(null===(a=c().asPath)||void 0===a?void 0:a.match("sign-up"))?"sign-up":"sign-in";(0,_.Qb)("/dashboard/all",u)}else e.email?(console.info("[Auth Page] User has ".concat(i.length," teams with the same domain")),i.length>0?S("/team/join"):k()):(console.info("[Auth Page] User doesn't have email, redirect to team create"),k())}})),(0,h.of)(e).pipe((0,m.b)(function(e){return console.info("[Auth Page] User signed out:",{uid:null==e?void 0:e.uid,email:null==e?void 0:e.email,isAnonymous:null==e?void 0:e.isAnonymous,displayName:null==e?void 0:e.displayName})}),(0,m.b)(function(){return(0,y.hf)()})))}))});return(0,l.m)(L,void 0,O),{error:t,profileArgs:i}}},76578:function(e,t,n){"use strict";n.r(t),n.d(t,{__N_SSP:function(){return l}});var r=n(52322),i=n(2784),o=n(5632),a=n(24179),u=n(58410),c=n(66464),s=n(69023),l=!0;t.default=function(){var e=(0,c.i)(),t=e.error,n=e.profileArgs,l=(0,o.useRouter)();return((0,i.useEffect)(function(){l.prefetch("/user/survey"),l.prefetch("/team/create"),l.prefetch("/team/join")},[]),t)?/*#__PURE__*/(0,r.jsx)(u.ZP,{statusCode:500,title:"Something went wrong"}):"undefined"==typeof document?null:/*#__PURE__*/(0,r.jsx)(s.Z,{staticLogo:!0,children:/*#__PURE__*/(0,r.jsx)(a.Z,{profileArgs:n})})}},57335:function(e,t,n){"use strict";n.r(t),n.d(t,{NOTION_INTEGRATION_REDIRECT_URL:function(){return f},default:function(){return d}});var r=n(52322),i=n(2784),o=n(37164),a=n(5632),u=n(58410),c=n(96933),s=n(67640),l=n(89960),f="https://www.notion.so/externalintegrationauthcallback",d=function(){var e=(0,a.useRouter)(),t=(0,c.fC)(),n=e.query.code,f=e.query.redirect_uri,d=e.query.state;return((0,i.useEffect)(function(){if(t&&n){if(null==t?void 0:t.isAnonymous){e.replace("/auth/sign-up?ref=notion&"+new URLSearchParams(e.query).toString());return}var r,i=(0,o.x0)();(r={notionAuthCode:n,tempAuthCode:i,userEmail:t.email,userDisplayName:t.displayName},s.Z.post("notion/retrieveToken",r,{responseType:"text"})).then(function(e){if(null==e){location.replace(f+"?error=access_denied&error_description=Not+valid+access+token..");return}location.replace(f+"?code=".concat(i,"&state=").concat(d))}).catch(function(e){(0,l.T)(e),location.replace(f+"?error=access_denied&error_description=An+internal+server+error+occurred.")})}},[t,n,d,f,e]),f&&n&&d)?null:/*#__PURE__*/(0,r.jsx)(u.ZP,{statusCode:400,title:"Not enough query parameters specified"})}}},function(e){e.O(0,[2888],function(){return e(e.s=34561)}),_N_E=e.O()}]);